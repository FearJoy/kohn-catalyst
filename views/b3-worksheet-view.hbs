<nav class="navbar navbar-fixed-top" style="padding-top:0px; padding-bottom:200px;">
	 <div class="input-group">
		<input type="text" id="note" class="form-control" placeholder="Enter Vetting Note Here...">
		<span class="input-group-btn">
			<button class="btn btn-primary" id="addNote" type="button">Add Note</button>
		</span>
	</div>
</nav>


<br><br>
<a href="/view" class="btn btn-primary">Back to Vetting Home</a> 
<!-- Set this next link to the proper route for Vetting View -->
<a href="/view/{{_id}}" class="btn btn-primary">Back to Application View</a>






<div class="container">
    <div class="row">
        <div class="col-xs-12">
            <h1>Vetting Worksheet for {{application.name.first}} {{application.name.last}}</h1>

			
			<!-- move vetting input and status selector to top (persistent div) -->
			<div>
				<table>
                    <tr>
					<form>
                        <td>
                            <input type="text" id="note" class="form-control" placeholder="Enter Note Here...">
                        </td>
                        <td>
                            <button id="addNote" type="submit" class="btn btn-primary">Add Note</button>
                        </td>
					</form>
						<td>
							<h4>Status: <a href="#" id="status" data-type="select" data-pk="1" data-url="/edit/{{_id}}" data-name="status" data-title="Select status"></a></h4>
						</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!--VETTING NOTES-->
            <h3>Vetting Notes</h3>
            <div class="col-xs-12">
                <table class="table table-striped" id="notes-table">
                    <thead>
                        <tr>
                            <th class="col-md-2">Date</th>
                            <th class="col-md-8">Note</th>
                        </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>11/1/2016</td>
                        <td>This is an example of where vetting agent notes would appear.</td>
                    </tr>
					</tbody>
				</table>
            </div>

            <h4>Address</h4>
			<div class="container-fluid">
				<div class="row">
					<div class="col-sm-5">
						<a id="address" href="#" data-type="address" data-pk="1" data-url="/edit/address/{{_id}}" data-title="Enter Address"></a>
					</div>
					<div class="col-sm-7">
						<a href="http://maps.google.com/?q={{application.address.line_1}} {{application.address.city}} {{application.address.state}} {{application.address.zip}}" target="_blank"><b>Map it!</b></a>
					</div>
				</div>
			</div>
			
			<br><h4>Is this Property within our Service Area?</h4>
			<div class="container-fluid">
				<div class="row">
					<div class="col-sm-3">
						<input type="radio" id="sa_yes" name="service_area" value="true"> Yes<br>
						<input type="radio" id="sa_no" name="service_area" value="false"> No
					</div>
					<div class="col-sm-9">
						[Vetting Agent Note: If no, change Application Status to "On Hold - Pending Discussion" and enter an applicable Vetting Note.]
					</div>
				</div>
			</div>

			<i><br><br>[Here is where the new stuff leaves off and the old stuff remains (mostly for reference...]<br><br></i>
			
			<table class="table table-striped">
                    <tbody>
				<tr>
                    <td>Name</td>
                    <td>
                        <a id="name" href="#" data-type="name" data-pk="1" data-url="/edit/name/{{_id}}" data-title="Enter Name"></a>
                    </td>
                </tr>
                <tr>
                    <td>Preferred Name</td>
                    <td><a href="#" id="pref_name" data-type="text" data-pk="1" data-url="/edit/{{_id}}" data-name="application.name.preferred" data-title="Enter Preferred Name">{{application.name.preferred}}</a></td>
                </tr>
                <tr>
                    <td>Preferred Phone</td>
                    <td><a href="#" id="phone_number" data-type="text" data-pk="1" data-url="/edit/{{_id}}" data-name="application.phone.preferred" data-title="Enter Preferred Phone Number">{{application.phone.preferred}}</a></td>
                </tr>
                <tr>
                    <td>Other Phone</td>
                    <td><a href="#" id="cell_phone" data-type="text" data-pk="1" data-url="/edit/{{_id}}" data-name="application.phone.other" data-title="Enter Other Phone Number">{{application.phone.other}}</a></td>
                </tr>
                <tr>
                    <td>Address</td>
                    <td>
                        <a id="address" href="#" data-type="address" data-pk="1" data-url="/edit/address/{{_id}}" data-title="Enter Address"></a>
                    </td>
                </tr>
                <tr>
                    <td>Date Of Birth</td>
                    <td><a href="#" id="dob" data-type="date" data-pk="1" data-url="/edit/{{_id}}" data-name="application.dob.date" data-title="Select date">{{application.dob.date}}</a></td>
                </tr>
                <tr>
                    <td>Marital Status</td>
                    <td>
                        <a href="#" id="marital_status" data-type="text" data-pk="1" data-url="/edit/{{_id}}" data-name="application.marital.status" data-title="Enter Marital Status">{{application.marital.status}}</a>
                    </td>
                </tr>
                <tr>
                    <td>Spouse</td>
                    <td>
                        <a href="#" id="spouse" data-type="text" data-pk="1" data-url="/edit/{{_id}}" data-name="application.marital.spouse" data-title="Enter Spouse Name">{{application.marital.spouse}}</a>
                    </td>
                </tr>
                <tr>
                    <td>Email</td>
                    <td><a href="#" id="email" data-type="text" data-pk="1" data-url="/edit/{{_id}}" data-name="application.email" data-title="Enter Email">{{application.email}}</a></td>
                </tr>
                <tr>
                    <td>Driver's License</td>
                    <td><a href="#" id="driver_license" data-type="text" data-pk="1" data-url="/edit/{{_id}}" data-name="application.driver_license.number" data-title="Enter Driver's License Number">{{application.driver_license.number}}</a></td>
                </tr>
                <tr>
                    <td>Emergency Contact</td>
                    <td>Name: <a href="#" id="emergency_name" data-type="text" data-pk="1" data-url="/edit/{{_id}}" data-name="application.emergency_contact.name" data-title="Enter Emergency Contact Name">{{application.emergency_contact.name}}</a>
                        <br>
                        Relationship: <a href="#" id="emergency_relation" data-type="text" data-pk="1" data-url="/edit/{{_id}}" data-name="application.emergency_contact.relationship" data-title="Enter Emergency Contact Relationship">{{application.emergency_contact.relationship}}</a>
                        <br>
                        Phone: <a href="#" id="emergency_phone" data-type="text" data-pk="1" data-url="/edit/{{_id}}" data-name="application.emergency_contact.phone" data-title="Enter Emergency Contact Phone Number">{{application.emergency_contact.phone}}</a>
                    </td>
                </tr>
                <tr>
                    <td>Language</td>
                    <td>{{application.language}}</td>
                </tr>
                <tr>
                    <td>Veteran</td>
                    <td>
                        <a href="#" id="veteran" data-type="select" data-pk="1" data-url="/edit/{{_id}}" data-name="application.veteran" data-title="Select Veteran Status"></a>
                    </td>
                </tr>
                <tr>
                    <td>Owns Home</td>
                    <td>
                        <a href="#" id="owns_home" data-type="select" data-pk="1" data-url="/edit/{{_id}}" data-name="application.owns_home" data-title="Select Home Ownership Status"></a>
                    </td>
                </tr>
                <tr>
                    <td>Special Circumstances</td>
                    <td>
                        <a href="#" id="special_circumstances" data-type="textarea" data-pk="1" data-url="/edit/{{_id}}" data-name="application.special_circumstances.note" data-title="Enter Special Circumstances">{{application.special_circumstances.note}}</a>
                    </td>
                </tr>
                </tbody>
            </table>

<!--WORK ITEMS -  PROBABLY NOT NECESSARY TO BE HERE, because it isn't part of the original application.  This section will be necessary in the Single-App-Vetting-View (phone script)
            <h3>Work Items</h3>
            <table class="table table-striped">
                <thead>
                <tr>
                    <th>Requested Repairs</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>Toilet Repair</td>
                    <td>This is an example of a work request entered by the agent visiting the home.</td>
                </tr>
                <tr>
                    <td>Cannot complete</td>
                    <td>This is an example of an item that is too costly to do; it must be rejected.</td>
                </tr>
                <tr>
                    <td>Mulling it over</td>
                    <td>This is an example of an item that might be completed!</td>
                </tr>
                </tbody>
            </table>
--END WORK ITEMS -->

<!--PROPERTY ITEMS-->
            <h3>Property</h3>
            <table class="table table-striped">
                <tbody>
                <tr>
                    <td>Home Type</td>
                    <td><a href="#" id="home_type" data-type="text" data-pk="1" data-url="/edit/{{_id}}" data-name="property.home_type" data-title="Enter Home Type">{{property.home_type}}</a></td>
                </tr>
                <tr>
                    <td>Length of Ownership</td>
                    <td><a href="#" id="ownership_length" data-type="text" data-pk="1" data-url="/edit/{{_id}}" data-name="property.ownership_length" data-title="Enter Ownership Length">{{property.ownership_length}}</a></td>
                </tr>
                <tr>
                    <td>Year Constructed</td>
                    <td><a href="#" id="year_constructed" data-type="text" data-pk="1" data-url="/edit/{{_id}}" data-name="property.year_constructed" data-title="Enter Year Constructed">{{property.year_constructed}}</a></td>
                </tr>
                <tr>
                    <td>Requested Repairs</td>
                    <td><a href="#" id="requested_repairs" data-type="text" data-pk="1" data-url="/edit/{{_id}}" data-name="property.requested_repairs" data-title="Enter Requested Repairs">{{property.requested_repairs}}</a></td>
                </tr>
                <tr>
                    <td>Other Residents</td>
                    <td>
                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th>Name</th>
                            <th>Age</th>
                            <th>Relationship</th>
                        </tr>
                        </thead>
                        <tbody>
                        {{#each application.other_residents.name}}
                        <tr>
                            <td>{{this}}</td>
                            <td>{{lookup ../application.other_residents.age @index}}</td>
                            <td>{{lookup ../application.other_residents.relationship @index}}</td>
                        </tr>
                        {{/each}}
                        </tbody>
                    </table>
                    </td>
                </tr>
                </tbody>
            </table>

<!--FINANCIAL INFO-->
            <h3>Finances</h3>
            <table class="table table-striped">
                <tbody>
                <tr>
                    <td>Mortgage Payment</td>
                    <td><a href="#" id="mortgage_payment" data-type="number" data-pk="1" data-url="/edit/{{_id}}" data-name="finance.mortgage.payment" data-title="Enter Mortgage Payment">{{finance.mortgage.payment}}</a></td>
                </tr>
                <tr>
                    <td>Mortgage Up-to-Date</td>
                    <td><a href="#" id="mortgage" data-type="select" data-pk="1" data-url="/edit/{{_id}}" data-name="finance.mortgage.up_to_date" data-title="Is Mortgage Up-to-Date?"></a></td>
                </tr>
                <tr>
                    <td>Income Amount</td>
                    <td><a href="#" id="income" data-type="number" data-pk="1" data-url="/edit/{{_id}}" data-name="finance.income.amount" data-title="Enter Income">{{finance.income.amount}}</a></td>
                </tr>
                <tr>
                    <td>Client Can Contribute Financially</td>
                    <td>
                        <a href="#" id="f_client_can_contrib" data-type="select" data-pk="1" data-url="/edit/{{_id}}" data-name="finance.client_can_contribute.value" data-title="Can Client Contribute Financially?"></a>
                    </td>
                </tr>
                <tr>
                    <td>Client Financial Contribution</td>
                    <td><a href="#" id="f_client_contrib" data-type="text" data-pk="1" data-url="/edit/{{_id}}" data-name="finance.client_can_contribute.description" data-title="Enter Contribution Description">{{finance.client_can_contribute.description}}</a></td>
                </tr>
                <tr>
                    <td>Associates Can Contribute Financially</td>
                    <td>
                        <a href="#" id="f_associate_can_contrib" data-type="select" data-pk="1" data-url="/edit/{{_id}}" data-name="finance.associates_can_contribute.value" data-title="Can Associates Contribute Financially?"></a>
                    </td>
                </tr>
                <tr>
                    <td>Associate Financial Contribution</td>
                    <td><a href="#" id="f_associate_contrib" data-type="text" data-pk="1" data-url="/edit/{{_id}}" data-name="finance.associates_can_contribute.description" data-title="Enter Contribution Description">{{finance.associates_can_contribute.description}}</a></td>
                </tr>
				</tbody>
			</table>
			<table class="table table-striped">
                <tbody>
                <tr>
                    <td>Assets</td>
                    <td>
                        <table class="table table-striped">
                            <thead>
                            <tr>
                                <th>Asset</th>
                                <th>Amount</th>
                            </tr>
                            </thead>
                            <!--This will iterate over all assets but does not have unique ids, which means only 1st is editable-->
                        {{#each finance.assets.name}}
                           <tr>
                               <td><a href="#" id="f_asset_name" data-type="text" data-pk="{{this}}" data-url="/edit/array/{{../_id}}" data-name="finance.assets.name">{{this}}</a></td>
                               <td>{{lookup ../finance.assets.value @index}}</td>
                           </tr>
                        {{/each}}
                        </table>
                    </td>
                </tr>
                </tbody>
            </table>

<!--LABOR HELP-->
            <h3>Assistance</h3>
            <table class="table table-striped">
                <tbody>
                <tr>
                    <td>Client Can Contribute Labor</td>
                    <td>
                        <a href="#" id="l_client_can_contrib" data-type="select" data-pk="1" data-url="/edit/{{_id}}" data-name="property.client_can_contribute.value" data-title="Can Client Contribute Labor?"></a>
                    </td>
                </tr>
                <tr>
                    <td>Client Labor Contribution</td>
                    <td><a href="#" id="l_client_contrib" data-type="text" data-pk="1" data-url="/edit/{{_id}}" data-name="property.client_can_contribute.description" data-title="Enter Contribution Description">{{property.client_can_contribute.description}}</a></td>
                </tr>
                <tr>
                    <td>Associates Can Contribute Labor</td>
                    <td>
                        <a href="#" id="l_associate_can_contrib" data-type="select" data-pk="1" data-url="/edit/{{_id}}" data-name="property.associates_can_contribute.value" data-title="Can Associates Contribute Labor?"></a>
                    </td>
                </tr>
                <tr>
                    <td>Associate Labor Contribution</td>
                    <td><a href="#" id="l_associate_contrib" data-type="text" data-pk="1" data-url="/edit/{{_id}}" data-name="property.associates_can_contribute.description" data-title="Enter Contribution Description">{{property.associates_can_contribute.description}}</a></td>
                </tr>
                <tr>
                    <td>Involved with a Faith-Based Organization</td>
                    <td>
                        <a href="#" id="fbo_help" data-type="select" data-pk="1" data-url="/edit/{{_id}}" data-name="recruitment.fbo_help" data-title="Does client belong to an FBO?"></a>
                    </td>
                </tr>
                <tr>
                    <td>Client Contribution</td>
                    <td><a href="#" id="fbo_name" data-type="text" data-pk="1" data-url="/edit/{{_id}}" data-name="recruitment.fbo_name" data-title="Enter Name of FBO">{{recruitment.fbo_name}}</a></td>
                </tr>
                <tr>
                    <td>Requested Other Help</td>
                    <td><a href="#" id="request_help" data-type="select" data-pk="1" data-url="/edit/{{_id}}" data-name="finance.requested_other_help.value" data-title="Client Requested Other Help?"></a></td>
                </tr>
                </tbody>
            </table>

        </div>
    </div>
</div>


<script>
    function goBack() {
        window.history.back();
    }
</script>


<script>
    /**
     * Some inline-editable fields require data from the DB to properly work
     *  They are defined here instead of a seperate file since it needs access
     *  to the handlebars template system
     */
    $(document).ready(function() {
        $('#address').editable({
            value: {
                line_1: '{{application.address.line_1}}',
                line_2: '{{application.address.line_2}}',
                city: '{{application.address.city}}',
                state: '{{application.address.state}}',
                zip: '{{application.address.zip}}'
            }
        });

        $('#name').editable({
            value: {
                first: '{{application.name.first}}',
                middle: '{{application.name.middle}}',
                last: '{{application.name.last}}'
            }
        });

        $('#veteran').editable({
            value: '{{application.veteran}}',
            source:
                    [
                        {value: 'true', text: 'true'},
                        {value: 'false', text: 'false'}
                    ]
        });

        $('#mortgage').editable({
            value: '{{finance.mortgage.up_to_date}}',
            source:
                    [
                        {value: 'true', text: 'True'},
                        {value: 'false', text: 'False'}
                    ]
        });

        $('#status').editable({
            value: '{{status}}',
            source:
                    [
                        {value: 'discuss', text: 'On Hold - Pending Discussion'},
                        {value: 'new', text: 'NEW'},
                        {value: 'phone', text: 'Phone Call Needed'},
                        {value: 'handle', text: 'Handle-It'},
                        {value: 'documents', text: 'Awaiting Documents'},
                        {value: 'visit', text: 'Site Assessment'}, //TODO: Change to assess
                        {value: 'approval', text: 'Approval Process'},
                        {value: 'declined', text: 'Declined'},
                        {value: 'withdrawn', text: 'Withdrawn'},
                        {value: 'project', text: 'Approved Project'}
                    ]
        });

        $('#owns_home').editable({
            value: '{{application.owns_home}}',
            source:
                    [
                        {value: 'true', text: 'true'},
                        {value: 'false', text: 'false'}
                    ]
        });

        $('#f_client_can_contrib').editable({
            value: '{{finance.client_can_contribute.value}}',
            source:
                    [
                        {value: 'true', text: 'true'},
                        {value: 'false', text: 'false'}
                    ]
        });

        $('#f_associate_can_contrib').editable({
            value: '{{finance.associates_can_contribute.value}}',
            source:
                    [
                        {value: 'true', text: 'true'},
                        {value: 'false', text: 'false'}
                    ]
        });

        $('#l_client_can_contrib').editable({
            value: '{{property.client_can_contribute.value}}',
            source:
                    [
                        {value: 'true', text: 'true'},
                        {value: 'false', text: 'false'}
                    ]
        });

        $('#l_associate_can_contrib').editable({
            value: '{{property.associates_can_contribute.value}}',
            source:
                    [
                        {value: 'true', text: 'true'},
                        {value: 'false', text: 'false'}
                    ]
        });

        $('#request_help').editable({
            value: '{{finance.requested_other_help.value}}',
            source:
                    [
                        {value: 'true', text: 'true'},
                        {value: 'false', text: 'false'}
                    ]
        });

        $('#fbo_help').editable({
            value: '{{recruitment.fbo_help}}',
            source:
                    [
                        {value: 'true', text: 'true'},
                        {value: 'false', text: 'false'}
                    ]
        });

    });

</script>